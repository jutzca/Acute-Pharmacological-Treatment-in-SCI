new.data =new_tab_pid %>% rowwise%>% mutate(m = sum(c(X1:X7)))
new.data$m
9  +  10  +  10 +    9  +   9   + 10  +  12
9  +  10  +  10 +    9  +   9   + 10
new.data =new_tab_pid %>% rowwise%>% mutate(m = sum(c(X1,X2,X3,X4,X5,X6,X7)))
new.data$m
9  +  10  +  10 +    9  +   9   + 10
9  +  10  +  10 +    9  +   9   + 10  +  12
#Make copy of data file to work with
sygen.medication.data.3 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.3[sygen.medication.data.3>0] <- 1
sygen.medication.data.3[is.na(sygen.medication.data.3)] <- 0
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.3[sygen.medication.data.3>0] <- 1
sygen.medication.data.3[is.na(sygen.medication.data.3)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.3[,i], by=list(Category=sygen.medication.data.3$generic_name), FUN=sum)
}
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum =sygen_medication_wide.sum %>% rowwise%>% mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.3[,i], by=list(Category=sygen.medication.data.3$generic_name), FUN=sum)
}
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1], sygen.medication.data.3["NEW_ID"], FUN=sum)
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum =sygen_medication_wide.sum %>% rowwise%>% mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
sygen_medication_wide.sum
names(sygen_medication_wide.sum)
sygen_medication_wide.sum =sygen_medication_wide.sum %>% rowwise%>% mutate(sum_30_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,
X21,X22,X23,X24,X25,X26,X27,X28,X29,X30)))
sygen_medication_wide.sum$sum_30_days
sygen_medication_wide.sum = as.data.frame(sygen_medication_wide.sum)
mean(sygen_medication_wide.sum$sum_14_days)
mean(sygen_medication_wide.sum$sum_7_days)
names(sygen.medication.data)
generic_name
sygen.medication.data$generic_name
sygen.medication.data.3
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1], sygen.medication.data.3[c("NEW_ID", "generic_name"], FUN=sum)
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1], sygen.medication.data.3[c("NEW_ID", "generic_name")], FUN=sum)
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1], sygen.medication.data.3["generic_name"], FUN=sum)
sygen_medication_wide
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum$sum_7_days
sygen.medication.data.3.subset
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
sygen_medication_wide
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum = as.data.frame(sygen_medication_wide.sum)
mean(sygen_medication_wide.sum$sum_14_days)
mean(sygen_medication_wide.sum$sum_7_days)
sygen_medication_wide.sum
sygen_medication_wide.sum$sum_7_days
sygen_medication_wide.sum[sygen_medication_wide.sum>0] <- 1
sygen_medication_wide.sum[sygen_medication_wide.sum==0] <- 0
sygen_medication_wide.sum
mean(sygen_medication_wide.sum$sum_7_days)
sygen_medication_wide.sum =sygen_medication_wide %>% count(Group.1,Group.2) %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum =sygen_medication_wide %>% count(Group.1,Group.2)
sygen_medication_wide.sum
names(sygen_medication_wide)
sygen.medication.data.3.subset2 <- sygen.medication.data.3[c(1:9)]
sygen.medication.data.3.subset2
names(sygen.medication.data.3.subset2)
#Subset Data for 60 days post injury
sygen.medication.data.3.subset2 <- sygen.medication.data.3[c(2:11)]
names(sygen.medication.data.3.subset2)
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
## ---------------------------
##
## Script name: 2_medication_desription_sygen
##
## Purpose of script: To describe and quantify the number of medications patients received within the first 60 days post injury.
##
## Author: Dr. Catherine Jutzeler
##
## Date Created: 2020-12-2
##
## Copyright (c) Catherine Jutzeler, 2020
## Email: catherine.jutzeler@bsse.ethz.ch
##
## ---------------------------
##
## Data source: Sygen Clinical Trial
##
## Notes: This analysis is for the publication Jutzeler et al, 2021 published in XX
##
#### ---------------------------
## set working directory
setwd("/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/")
## ---------------------------
## load up the packages we will need:
library("dplyr")
library(tidyr)
library(tidyverse)
library(hrbrthemes)
library(formattable)
library(viridis)
library(ggplot2)
library(ggpubr)
library(naniar)
## ----------------------------
## Install packages needed:  (uncomment as required)
#if(!require(dplyr)){install.packages("dplyr")}
#if(!require(tidyr)){install.packages("tidyr")}
#if(!require(tidyverse)){install.packages("tidyverse")}
#if(!require(hrbrthemes)){install.packages("hrbrthemes")}
#if(!require(formattable)){install.packages("formattable")}
#if(!require(viridis)){install.packages("viridis")}
#if(!require(ggplot2)){install.packages("ggplot2")}
#if(!require(ggpubr)){install.packages("ggpubr")}
#if(!require(naniar)){install.packages("naniar")}
#### ---------------------------
#Clear working space
rm(list = ls())
#### ---------------------------
#Set output directorypaths
outdir_figures='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Figures/Sygen'
outdir_tables='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Tables/Sygen'
#### -------------------------------------------------------------------------- CODE START ------------------------------------------------------------------------------------------------####
#load original sygen medication dataset
sygen.medication.data <- read.csv("/Volumes/jutzelec$/8_Projects/1_Ongoing/3_Drugs/masterfile/masterfile.csv", header = T, sep = ',')
names(sygen.medication.data)
#-------------------------Calculate and visualize point prevalance of medication administration (i.e., number of medications administered per day per patient)-----------------
#Make copy of data file to work with
sygen.medication.data.2 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.2[sygen.medication.data.2>0] <- 1
sygen.medication.data.2[is.na(sygen.medication.data.2)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.2[,i], by=list(Category=sygen.medication.data.2$generic_name), FUN=sum)
}
#Subset Data
sygen.medication.data.2.subset <- sygen.medication.data.2[c(4:64)]
#Aggregate data: Number of medications per day for each patient
new_tab_pid<-aggregate(sygen.medication.data.2.subset[-1], sygen.medication.data.2["NEW_ID"], FUN=sum)
#Reformat data from wide to long
new_tab_pid_long <- gather(new_tab_pid, day, prevalence, X1:X60, factor_key=TRUE)
new_tab_pid_long
#change columns 4:368 to numerics class format
cols_to_change = c(2:3)
for(i in cols_to_change){
class(new_tab_pid_long[, i]) = "numeric"
}
##Replace 0s with na
new_tab_pid_long_withna<- new_tab_pid_long %>% replace_with_na(replace = list(prevalence = 0))
#Plot point prevalence
point.prevalence.sygen <-ggplot(data=new_tab_pid_long_withna, aes(x = day, y = NEW_ID, fill = prevalence)) +
viridis::scale_fill_viridis(name="Number of \nMedications Administered",
option = 'plasma',
direction = 1,
na.value = "white") +
geom_tile(color = 'white', size = 0.1) + scale_x_continuous(
expand = c(0, 0), breaks = c(0, 30,60)) +
ggtitle("Sygen trial (n=791)")+ labs(x="Days Post-Injury", y="")+ theme_classic()+
theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),axis.title.x = element_text(size = 10) ,axis.text.x = element_text(color="black", size=8),  axis.ticks.y =element_blank(),  axis.text.y = element_blank(), axis.title.y  = element_blank())
point.prevalence.sygen
#-------------------------Calculate and visualize number of drugs per patient with 7,14, and 30 days respectively-----------------
#Make copy of data file to work with
sygen.medication.data.3 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.3[sygen.medication.data.3>0] <- 1
sygen.medication.data.3[is.na(sygen.medication.data.3)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.3[,i], by=list(Category=sygen.medication.data.3$generic_name), FUN=sum)
}
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
sygen_medication_wide = sygen_medication_wide[c(4:64)]
sygen.medication.data.3
names(sygen.medication.data.3)
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
sygen.medication.data.3.subset
names(sygen.medication.data.3)
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(2:64)]
names(sygen.medication.data.3)
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
sygen_medication_wide = sygen_medication_wide[c(4:64)]
sygen_medication_wide.sum =sygen_medication_wide %>% count(Group.1,Group.2)
sygen_medication_wide.sum
names(sygen_medication_wide)
sygen_medication_wide = sygen_medication_wide[c(1:9)]
sygen_medication_wide.sum =sygen_medication_wide %>% count(Group.1,Group.2)
sygen_medication_wide
sygen_medication_wide.sum
sygen_medication_wide.sum$n
sygen_medication_wide.sum =sygen_medication_wide %>% sum(Group.1,Group.2)
sygen_medication_wide
sygen_medication_wide.sum =sygen_medication_wide %>% count(X1,X2,X3,X4,X5,X6,X7)
sygen_medication_wide.sum
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum
sygen_medication_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
sygen_medication_wide.sum
sygen_medication_wide.sum.7 =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum.7
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum =sygen_medication_wide.sum %>% rowwise%>% mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
sygen_medication_wide.sum =sygen_medication_wide.sum %>% rowwise%>% mutate(sum_30_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,
X21,X22,X23,X24,X25,X26,X27,X28,X29,X30)))
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
sygen_medication_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
#Calcualte number of patients
sygen_medication_wide.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
sygen_medication_wide.sum = as.data.frame(sygen_medication_wide.sum)
mean(sygen_medication_wide.sum$sum_7_days)
sygen_medication_wide.sum
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
sygen_medication_wide.sum.subset <- sygen_medication_wide.sum[c(1,2,10)]
header(sygen_medication_wide.sum.subset)
head(sygen_medication_wide.sum.subset)
ion_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
#Covert all numbers greater than 1 to 1
sygen_medication_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
#Subset data
sygen_medication_wide.sum.subset <- sygen_medication_wide.sum[c(1,2,10)]
sygen_medication_wide.sum.subset %>% count(Group.2)
sygen_medication_wide.sum.subset %>% count(Group.2, sum_7_days)
sygen_medication_wide.sum.subset %>% sum(Group.2, sum_7_days)
sygen_medication_wide.sum.subset %>%
group_by(Group.2 ) %>%
summarise(Frequency = sum(Frequency))
sygen_medication_wide.sum.subset %>%
group_by(Group.2
sygen_medication_wide.sum.subset %>%
group_by(Group.2 )
sygen_medication_wide.sum.subset %>%
group_by(Group.2)%>%
summarise(Frequency = sum(sum_7_days))
mean(sygen_medication_wide.sum.subset$Frequency)
x7_days_mean <- sygen_medication_wide.sum.subset %>%
group_by(Group.2)%>%
summarise(Frequency = sum(sum_7_days))
mean(x7_days_mean$Frequency)
sygen_medication_wide.14.sum =sygen_medication_wide %>% rowwise%>% mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
#Covert all numbers greater than 1 to 1
sygen_medication_wide.14.sum$sum_14_days[sygen_medication_wide.14.sum$sum_14_days>0] <- 1
#Covert all numbers greater than 1 to 1
sygen_medication_wide.14.sum$sum_14_days[sygen_medication_wide.14.sum$sum_14_days>0] <- 1
#Subset data
sygen_medication_wide.14.sum.subset <- sygen_medication_wide.14.sum[c(1,2,10)]
#Calcualte number of unique drugs given per patient within first 7 days post injury
x14_days_mean <- sygen_medication_wide.14.sum.subset %>%
group_by(Group.2)%>%
summarise(Frequency = sum(sum_14_days))
sygen_medication_wide.14.sum.subset
#Subset data
sygen_medication_wide.14.sum.subset <- sygen_medication_wide.14.sum[c(1,2,18)]
sygen_medication_wide.14.sum.subset
sygen_medication_wide.14.sum
#Subset data
sygen_medication_wide.14.sum.subset <- sygen_medication_wide.14.sum[c(1,2,18)]
sygen_medication_wide.14.sum.subset
sygen_medication_wide.14.sum
sygen_medication_wide.sum
#Calcualte number of patients
sygen_medication_wide.sum.14 =sygen_medication_wide %>% rowwise%>%mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
sygen_medication_wide.sum.14
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum
## ---------------------------
##
## Script name: 2_medication_desription_sygen
##
## Purpose of script: To describe and quantify the number of medications patients received within the first 60 days post injury.
##
## Author: Dr. Catherine Jutzeler
##
## Date Created: 2020-12-2
##
## Copyright (c) Catherine Jutzeler, 2020
## Email: catherine.jutzeler@bsse.ethz.ch
##
## ---------------------------
##
## Data source: Sygen Clinical Trial
##
## Notes: This analysis is for the publication Jutzeler et al, 2021 published in XX
##
#### ---------------------------
## set working directory
setwd("/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/")
## ---------------------------
## load up the packages we will need:
library("dplyr")
library(tidyr)
library(tidyverse)
library(hrbrthemes)
library(formattable)
library(viridis)
library(ggplot2)
library(ggpubr)
library(naniar)
## ----------------------------
## Install packages needed:  (uncomment as required)
#if(!require(dplyr)){install.packages("dplyr")}
#if(!require(tidyr)){install.packages("tidyr")}
#if(!require(tidyverse)){install.packages("tidyverse")}
#if(!require(hrbrthemes)){install.packages("hrbrthemes")}
#if(!require(formattable)){install.packages("formattable")}
#if(!require(viridis)){install.packages("viridis")}
#if(!require(ggplot2)){install.packages("ggplot2")}
#if(!require(ggpubr)){install.packages("ggpubr")}
#if(!require(naniar)){install.packages("naniar")}
#### ---------------------------
#Clear working space
rm(list = ls())
#### ---------------------------
#Set output directorypaths
outdir_figures='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Figures/Sygen'
outdir_tables='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Tables/Sygen'
#### -------------------------------------------------------------------------- CODE START ------------------------------------------------------------------------------------------------####
#load original sygen medication dataset
sygen.medication.data <- read.csv("/Volumes/jutzelec$/8_Projects/1_Ongoing/3_Drugs/masterfile/masterfile.csv", header = T, sep = ',')
names(sygen.medication.data)
#-------------------------Calculate and visualize point prevalance of medication administration (i.e., number of medications administered per day per patient)-----------------
#Make copy of data file to work with
sygen.medication.data.2 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.2[sygen.medication.data.2>0] <- 1
sygen.medication.data.2[is.na(sygen.medication.data.2)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.2[,i], by=list(Category=sygen.medication.data.2$generic_name), FUN=sum)
}
#Subset Data
sygen.medication.data.2.subset <- sygen.medication.data.2[c(4:64)]
#Aggregate data: Number of medications per day for each patient
new_tab_pid<-aggregate(sygen.medication.data.2.subset[-1], sygen.medication.data.2["NEW_ID"], FUN=sum)
#Reformat data from wide to long
new_tab_pid_long <- gather(new_tab_pid, day, prevalence, X1:X60, factor_key=TRUE)
new_tab_pid_long
#change columns 4:368 to numerics class format
cols_to_change = c(2:3)
for(i in cols_to_change){
class(new_tab_pid_long[, i]) = "numeric"
}
##Replace 0s with na
new_tab_pid_long_withna<- new_tab_pid_long %>% replace_with_na(replace = list(prevalence = 0))
#Plot point prevalence
point.prevalence.sygen <-ggplot(data=new_tab_pid_long_withna, aes(x = day, y = NEW_ID, fill = prevalence)) +
viridis::scale_fill_viridis(name="Number of \nMedications Administered",
option = 'plasma',
direction = 1,
na.value = "white") +
geom_tile(color = 'white', size = 0.1) + scale_x_continuous(
expand = c(0, 0), breaks = c(0, 30,60)) +
ggtitle("Sygen trial (n=791)")+ labs(x="Days Post-Injury", y="")+ theme_classic()+
theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),axis.title.x = element_text(size = 10) ,axis.text.x = element_text(color="black", size=8),  axis.ticks.y =element_blank(),  axis.text.y = element_blank(), axis.title.y  = element_blank())
point.prevalence.sygen
#-------------------------Calculate and visualize number of drugs per patient with 7,14, and 30 days respectively-----------------
#Make copy of data file to work with
sygen.medication.data.3 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.3[sygen.medication.data.3>0] <- 1
sygen.medication.data.3[is.na(sygen.medication.data.3)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.3[,i], by=list(Category=sygen.medication.data.3$generic_name), FUN=sum)
}
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
setwd("/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/")
## ---------------------------
## load up the packages we will need:
library("dplyr")
library(tidyr)
library(tidyverse)
library(hrbrthemes)
library(formattable)
library(viridis)
library(ggplot2)
library(ggpubr)
library(naniar)
rm(list = ls())
outdir_figures='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Figures/Sygen'
outdir_tables='/Users/jutzca/Documents/Github/Acute-Pharmacological-Treatment-in-SCI/Tables/Sygen'
#load original sygen medication dataset
sygen.medication.data <- read.csv("/Volumes/jutzelec$/8_Projects/1_Ongoing/3_Drugs/masterfile/masterfile.csv", header = T, sep = ',')
names(sygen.medication.data)
#Make copy of data file to work with
sygen.medication.data.2 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.2[sygen.medication.data.2>0] <- 1
sygen.medication.data.2[is.na(sygen.medication.data.2)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.2[,i], by=list(Category=sygen.medication.data.2$generic_name), FUN=sum)
}
#Subset Data
sygen.medication.data.2.subset <- sygen.medication.data.2[c(4:64)]
#Aggregate data: Number of medications per day for each patient
new_tab_pid<-aggregate(sygen.medication.data.2.subset[-1], sygen.medication.data.2["NEW_ID"], FUN=sum)
#Reformat data from wide to long
new_tab_pid_long <- gather(new_tab_pid, day, prevalence, X1:X60, factor_key=TRUE)
new_tab_pid_long
#change columns 4:368 to numerics class format
cols_to_change = c(2:3)
for(i in cols_to_change){
class(new_tab_pid_long[, i]) = "numeric"
}
##Replace 0s with na
new_tab_pid_long_withna<- new_tab_pid_long %>% replace_with_na(replace = list(prevalence = 0))
#Plot point prevalence
point.prevalence.sygen <-ggplot(data=new_tab_pid_long_withna, aes(x = day, y = NEW_ID, fill = prevalence)) +
viridis::scale_fill_viridis(name="Number of \nMedications Administered",
option = 'plasma',
direction = 1,
na.value = "white") +
geom_tile(color = 'white', size = 0.1) + scale_x_continuous(
expand = c(0, 0), breaks = c(0, 30,60)) +
ggtitle("Sygen trial (n=791)")+ labs(x="Days Post-Injury", y="")+ theme_classic()+
theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),axis.title.x = element_text(size = 10) ,axis.text.x = element_text(color="black", size=8),  axis.ticks.y =element_blank(),  axis.text.y = element_blank(), axis.title.y  = element_blank())
point.prevalence.sygen
#Make copy of data file to work with
sygen.medication.data.3 <- sygen.medication.data
#Replace all values greater than 0 with a 1 and all na's will be replaced with a 0
sygen.medication.data.3[sygen.medication.data.3>0] <- 1
sygen.medication.data.3[is.na(sygen.medication.data.3)] <- 0
#change columns to numerics class format
cols_to_change = c(4:6)
for(i in cols_to_change){
aggregate(sygen.medication.data.3[,i], by=list(Category=sygen.medication.data.3$generic_name), FUN=sum)
}
#Subset Data for 60 days post injury
sygen.medication.data.3.subset <- sygen.medication.data.3[c(4:64)]
#Aggregate data: Number of medications per day for each patient
sygen_medication_wide<-aggregate(sygen.medication.data.3.subset[-1],by=list(sygen.medication.data.3$generic_name, sygen.medication.data.3$NEW_ID), FUN=sum)
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
#Covert all numbers greater than 1 to 1
sygen_medication_wide.sum$sum_7_days[sygen_medication_wide.sum$sum_7_days>0] <- 1
#Subset data
sygen_medication_wide.sum.subset <- sygen_medication_wide.sum[c(1,2,10)]
#Calcualte number of unique drugs given per patient within first 7 days post injury
x7_days_mean <- sygen_medication_wide.sum.subset %>%
group_by(Group.2)%>%
summarise(Frequency = sum(sum_7_days))
#Calculate mean and sd for 7 days
mean(x7_days_mean$Frequency)
sd(x7_days_mean$Frequency)
min(x7_days_mean$Frequency)
max(x7_days_mean$Frequency)
#Subset data
sygen_medication_wide.sum.subset <- sygen_medication_wide.sum[c(1,2,10)]
sygen_medication_wide.sum.subset
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise%>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum
sygen_medication_wide
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise %>% mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum
#Calcualte number of patients
sygen_medication_wide.sum.14 =sygen_medication_wide %>% rowwise %>% dplyr::mutate(sum_14_days = sum(c(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14)))
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise %>% dplyr::mutate(sum_7_days = sum(c(X1,X2,X3,X4,X5,X6,X7)))
sygen_medication_wide.sum
sygen_medication_wide
####------ 7-day average and standard deviation
#Calcualte number of patients
sygen_medication_wide.sum = sygen_medication_wide %>% rowwise %>% mutate(sum_7_days = sum(c(X1,X2)))
sygen_medication_wide.sum
